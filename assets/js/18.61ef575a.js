(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{423:function(s,t,a){"use strict";a.r(t);var e=a(2),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"会话技术"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#会话技术"}},[s._v("#")]),s._v(" 会话技术")]),s._v(" "),t("h3",{attrs:{id:"cookie"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[s._v("#")]),s._v(" Cookie")]),s._v(" "),t("p",[t("code",[s._v("Cookie")]),s._v("：客户端会话技术，将数据保存到客户端，以后每次请求都携带Cookie数据进行访问。")]),s._v(" "),t("ul",[t("li",[s._v("服务端提供了两个Servlet，分别是ServletA和ServletB")]),s._v(" "),t("li",[s._v("浏览器发送HTTP请求1给服务端，服务端ServletA接收请求并进行业务处理")]),s._v(" "),t("li",[s._v("服务端ServletA在处理的过程中可以创建一个Cookie对象并将"),t("code",[s._v("name=zs")]),s._v("的数据存入Cookie")]),s._v(" "),t("li",[s._v("服务端ServletA在响应数据的时候，会把Cookie对象响应给浏览器")]),s._v(" "),t("li",[s._v("浏览器接收到响应数据，会把Cookie对象中的数据存储在浏览器内存中，此时浏览器和服务端就==建立了一次会话")]),s._v(" "),t("li",[s._v("在同一次会话==中浏览器再次发送HTTP请求2给服务端ServletB，浏览器会携带Cookie对象中的所有数据")]),s._v(" "),t("li",[s._v("ServletB接收到请求和数据后，就可以获取到存储在Cookie对象中的数据，这样同一个会话中的多次请求之间就实现了数据共享")])]),s._v(" "),t("h4",{attrs:{id:"发送cookie"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#发送cookie"}},[s._v("#")]),s._v(" "),t("strong",[s._v("发送Cookie")])]),s._v(" "),t("ul",[t("li",[s._v("创建Cookie对象，并设置数据")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('Cookie cookie = new Cookie("key","value");\n')])])]),t("ul",[t("li",[s._v("设置Cookie的存活时间")])]),s._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("cookie"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMaxAge")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" seconds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1.正数：将Cookie写入浏览器所在电脑的硬盘，持久化存储。到时间自动删除")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2.负数：默认值，Cookie在当前浏览器内存中，当浏览器关闭，则Cookie被销毁")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.零：删除对应Cookie")]),s._v("\n")])])]),t("ul",[t("li",[s._v("发送Cookie到客户端：使用==response==对象")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("response.addCookie(cookie);\n")])])]),t("h4",{attrs:{id:"获取cookie"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取cookie"}},[s._v("#")]),s._v(" "),t("strong",[s._v("获取Cookie")])]),s._v(" "),t("ul",[t("li",[s._v("jsp获取")])]),s._v(" "),t("div",{staticClass:"language-jsp extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("${cookie.key.value}\n")])])]),t("ul",[t("li",[s._v("获取客户端携带的所有Cookie，使用==request==对象")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Cookie[] cookies = request.getCookies();\n")])])]),t("ul",[t("li",[s._v("遍历数组，获取每一个Cookie对象：for")]),s._v(" "),t("li",[s._v("使用Cookie对象方法获取数据")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cookie.getName();\ncookie.getValue();\n")])])]),t("h4",{attrs:{id:"cookie存储中文"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cookie存储中文"}},[s._v("#")]),s._v(" Cookie存储中文")]),s._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//对中文进行URL编码")]),s._v("\n        value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("URLEncoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("encode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"存储数据："')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//URL解码")]),s._v("\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("URLDecoder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("decode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UTF-8"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h3",{attrs:{id:"session"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#session"}},[s._v("#")]),s._v(" Session")]),s._v(" "),t("p",[t("code",[s._v("Session")]),s._v("：服务端会话跟踪技术：将数据保存到服务端。")]),s._v(" "),t("ul",[t("li",[s._v("Session是存储在服务端而Cookie是存储在客户端")]),s._v(" "),t("li",[s._v("存储在客户端的数据容易被窃取和截获，存在很多不安全的因素")]),s._v(" "),t("li",[s._v("存储在服务端的数据相比于客户端来说就更安全")])]),s._v(" "),t("h4",{attrs:{id:"方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法"}},[s._v("#")]),s._v(" 方法")]),s._v(" "),t("p",[s._v("在JavaEE中提供了"),t("code",[s._v("HttpSession")]),s._v("接口，来实现一次会话的多次请求之间数据共享功能。")]),s._v(" "),t("ul",[t("li",[s._v("获取Session对象,使用的是request对象")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("HttpSession session = request.getSession();\n")])])]),t("ul",[t("li",[t("p",[s._v("Session对象提供的功能:")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("存储数据到 session 域中")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("void setAttribute(String name, Object o)\n")])])])]),s._v(" "),t("li",[t("p",[s._v("根据 key，获取值")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Object getAttribute(String name)\n")])])])]),s._v(" "),t("li",[t("p",[s._v("根据 key，删除该键值对")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("void removeAttribute(String name)\n")])])])])])])]),s._v(" "),t("h4",{attrs:{id:"session的原理分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#session的原理分析"}},[s._v("#")]),s._v(" Session的原理分析")]),s._v(" "),t("blockquote",[t("p",[s._v("Session是基于Cookie实现的")])]),s._v(" "),t("p",[s._v("(1)demo1在第一次获取session对象的时候，session对象会有一个唯一的标识，假如是"),t("code",[s._v("id:10")])]),s._v(" "),t("p",[s._v("(2)demo1在session中存入其他数据并处理完成所有业务后，需要通过Tomcat服务器响应结果给浏览器")]),s._v(" "),t("p",[s._v("(3**)Tomcat服务器发现业务处理中使用了session对象，就会把session的唯一标识"),t("code",[s._v("id:10")]),s._v("当做一个cookie，添加"),t("code",[s._v("Set-Cookie:JESSIONID=10")]),s._v("到响应头中，并响应给浏览器**")]),s._v(" "),t("p",[s._v("(4)浏览器接收到响应结果后，会把响应头中的coookie数据存储到浏览器的内存中")]),s._v(" "),t("p",[s._v("(5)浏览器在同一会话中访问demo2的时候，会把cookie中的数据按照"),t("code",[s._v("cookie: JESSIONID=10")]),s._v("的格式添加到请求头中并发送给服务器Tomcat")]),s._v(" "),t("p",[s._v("(6)demo2获取到请求后，从请求头中就读取cookie中的JSESSIONID值为10，然后就会到服务器内存中寻找"),t("code",[s._v("id:10")]),s._v("的session对象，如果找到了，就直接返回该对象，如果没有则新创建一个session对象")]),s._v(" "),t("p",[s._v("(7)关闭打开浏览器后，因为浏览器的cookie已被销毁，所以就没有JESSIONID的数据，服务端获取到的session就是一个全新的session对象")]),s._v(" "),t("blockquote",[t("p",[s._v("Session是基于Cookie来实现的")])]),s._v(" "),t("h4",{attrs:{id:"session钝化与活化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#session钝化与活化"}},[s._v("#")]),s._v(" Session钝化与活化")]),s._v(" "),t("p",[s._v("服务器重启后，Session中的数据是否还在?")]),s._v(" "),t("p",[s._v("(1)服务器端AServlet和BServlet共用的session对象应该是存储在服务器的内存中")]),s._v(" "),t("p",[s._v("(2)服务器重新启动后，内存中的数据应该是已经被释放，对象也应该都销毁了")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("钝化：在服务器正常关闭后，Tomcat会自动将Session数据写入硬盘的文件中")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("钝化的数据路径为:"),t("code",[s._v("项目目录\\target\\tomcat\\work\\Tomcat\\localhost\\项目名称\\SESSIONS.ser")])]),s._v(" "),t("img",{attrs:{src:s.$withBase("/images/1629440576828.png"),alt:"1629440576828"}})])])]),s._v(" "),t("li",[t("p",[s._v("活化：再次启动服务器后，从文件中加载数据到Session中")]),s._v(" "),t("ul",[t("li",[s._v("数据加载到Session中后，路径中的"),t("code",[s._v("SESSIONS.ser")]),s._v("文件会被删除掉")])])])]),s._v(" "),t("h4",{attrs:{id:"session销毁"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#session销毁"}},[s._v("#")]),s._v(" Session销毁")]),s._v(" "),t("p",[s._v("默认情况下，无操作，30分钟自动销毁")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("对于这个失效时间，是可以通过配置进行修改的")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("在项目的web.xml中配置")]),s._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token prolog"}},[s._v('<?xml version="1.0" encoding="UTF-8"?>')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("web-app")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("xmlns")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://xmlns.jcp.org/xml/ns/javaee"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("xmlns:")]),s._v("xsi")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://www.w3.org/2001/XMLSchema-instance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("xsi:")]),s._v("schemaLocation")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("3.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("session-config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("session-timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("100"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("session-timeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("session-config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("web-app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])])]),s._v(" "),t("li",[t("p",[s._v("如果没有配置，默认是30分钟，默认值是在Tomcat的web.xml配置文件中写死的")])])])])]),s._v(" "),t("ul",[t("li",[s._v("调用Session对象的invalidate()进行销毁")])]),s._v(" "),t("blockquote",[t("p",[s._v("Cookie 和 Session 都是来完成一次会话内多次请求间数据共享的。")]),s._v(" "),t("p",[s._v("所需两个对象放在一块，就需要思考:")]),s._v(" "),t("p",[s._v("Cookie和Session的区别是什么?")]),s._v(" "),t("p",[s._v("Cookie和Session的应用场景分别是什么?")]),s._v(" "),t("ul",[t("li",[s._v("区别:\n"),t("ul",[t("li",[s._v("存储位置：Cookie 是将数据存储在客户端，Session 将数据存储在服务端")]),s._v(" "),t("li",[s._v("安全性：Cookie不安全，Session安全")]),s._v(" "),t("li",[s._v("数据大小：Cookie最大3KB，Session无大小限制")]),s._v(" "),t("li",[s._v("存储时间：Cookie可以通过setMaxAge()长期存储，Session默认30分钟")]),s._v(" "),t("li",[s._v("服务器性能：Cookie不占服务器资源，Session占用服务器资源")])])]),s._v(" "),t("li",[s._v("应用场景:\n"),t("ul",[t("li",[s._v("购物车:使用Cookie来存储")]),s._v(" "),t("li",[s._v("以登录用户的名称展示:使用Session来存储")]),s._v(" "),t("li",[s._v("记住我功能:使用Cookie来存储")]),s._v(" "),t("li",[s._v("验证码:使用session来存储")])])]),s._v(" "),t("li",[s._v("结论\n"),t("ul",[t("li",[s._v("Cookie是用来保证用户在未登录情况下的身份识别")]),s._v(" "),t("li",[s._v("Session是用来保存用户登录后的数据")])])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);